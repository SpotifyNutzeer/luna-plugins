var E=Object.create;var x=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var U=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var s=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var A=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of M(n))!$.call(e,i)&&i!==t&&x(e,i,{get:()=>n[i],enumerable:!(o=v(n,i))||o.enumerable});return e};var u=(e,n,t)=>(t=e!=null?E(U(e)):{},A(n||!e||!e.__esModule?x(t,"default",{value:e,enumerable:!0}):t,e));var b=s((j,y)=>{y.exports=luna?.core?.modules?.["@luna/core"];if(y.exports===void 0)throw new Error("Cannot find module @luna/core in luna.core.modules");luna.core.LunaPlugin.plugins["@luna/core"]?.addDependant(luna.core.LunaPlugin.plugins["@spotifynutzeer/link-copy"])});var w=s((q,f)=>{f.exports=luna?.core?.modules?.["@luna/lib"];if(f.exports===void 0)throw new Error("Cannot find module @luna/lib in luna.core.modules");luna.core.LunaPlugin.plugins["@luna/lib"]?.addDependant(luna.core.LunaPlugin.plugins["@spotifynutzeer/link-copy"])});var S=s((z,k)=>{k.exports=luna?.core?.modules?.react;if(k.exports===void 0)throw new Error("Cannot find module react in luna.core.modules");luna.core.LunaPlugin.plugins.react?.addDependant(luna.core.LunaPlugin.plugins["@spotifynutzeer/link-copy"])});var P=s((O,m)=>{m.exports=luna?.core?.modules?.["@luna/ui"];if(m.exports===void 0)throw new Error("Cannot find module @luna/ui in luna.core.modules");luna.core.LunaPlugin.plugins["@luna/ui"]?.addDependant(luna.core.LunaPlugin.plugins["@spotifynutzeer/link-copy"])});var I=u(b(),1),l=u(w(),1);var c=u(S(),1),a=u(P(),1);var B=()=>c.default.createElement(a.LunaSettings,null,c.default.createElement(a.LunaButtonSetting,{title:"Copy Spotify Link",desc:"Copy the Spotify link for the currently playing track",onClick:()=>g("spotify")}),c.default.createElement(a.LunaButtonSetting,{title:"Copy YouTube Link",desc:"Copy the YouTube link for the currently playing track",onClick:()=>g("youtube")}));var{trace:_}=(0,I.Tracer)("[LinkCopy]"),L=new Set,p=null,d=null;async function h(e,n){if(d&&d.id===n)return console.log("[LinkCopy] Using cached links for track:",n),d.links;console.log("[LinkCopy] Fetching Odesli links for:",e);try{return(await(await fetch(`https://api.song.link/v1-alpha.1/links?url=${encodeURIComponent(e)}`)).json()).linksByPlatform}catch(t){return console.error("[LinkCopy] Odesli fetch failed:",t),null}}l.MediaItem.onMediaTransition(L,async e=>{try{let n=e.id,t=`https://listen.tidal.com/track/${n}`;console.log("[LinkCopy] Prefetching links for playing track:",n);let i=await(await fetch(`https://api.song.link/v1-alpha.1/links?url=${encodeURIComponent(t)}`)).json();d={id:n,links:i.linksByPlatform},console.log("[LinkCopy] Prefetch complete.")}catch(n){console.error("[LinkCopy] Prefetch failed:",n)}});function C(e,n){let t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),l.redux.store.dispatch({type:"message/MESSAGE_INFO",payload:{message:`${n} link copied to clipboard!`}})}function T(e,n,t){let o=e.cloneNode(!0),i=o.querySelector("button");return i&&(i.removeAttribute("data-test"),o.querySelectorAll("span").forEach(r=>{r.innerText&&r.innerText.length>1&&(r.innerText=n)}),i.onclick=r=>{r.preventDefault(),r.stopPropagation(),t()}),o.setAttribute("data-link-copy-injected","true"),o}l.ContextMenu.onMediaItem(L,async({mediaCollection:e})=>{try{let n=e.items||e.tMediaItems;if(n&&n.length>0){let t=n[0];p=t.id||t.item?.id,console.log("[LinkCopy] Context track set to:",p)}}catch{}});var D=setInterval(()=>{let e=document.querySelector('[data-test="copy-share-link"]');if(e&&p){let n=e.closest("li"),t=n?.parentElement;if(n&&t&&!t.querySelector('[data-link-copy-injected="true"]')){let o=p,i=`https://listen.tidal.com/track/${o}`;t.appendChild(T(n,"Copy Spotify Link",async()=>{let r=await h(i,o);r?.spotify?.url?C(r.spotify.url,"Spotify"):alert("Spotify link not found.")})),t.appendChild(T(n,"Copy YouTube Link",async()=>{let r=await h(i,o);r?.youtube?.url?C(r.youtube.url,"YouTube"):alert("YouTube link not found.")}))}}},300);L.add(()=>clearInterval(D));async function g(e){let n=await l.MediaItem.fromPlaybackContext();if(!n)return;let t=n.id,o=`https://listen.tidal.com/track/${t}`,r=(await h(o,t))?.[e]?.url;r&&C(r,e)}export{B as Settings,g as copyCurrentLink,_ as trace,L as unloads};
//# sourceMappingURL=spotifynutzeer.link-copy.mjs.map
