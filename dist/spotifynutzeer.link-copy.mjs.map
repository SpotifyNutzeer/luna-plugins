{
  "version": 3,
  "sources": ["dynamicExternals:@luna/core", "dynamicExternals:@luna/lib", "dynamicExternals:react", "dynamicExternals:@luna/ui", "../plugins/LinkCopy/src/index.ts", "../plugins/LinkCopy/src/Settings.tsx"],
  "sourcesContent": ["\n\t\t\t\t\tmodule.exports = luna?.core?.modules?.[\"@luna/core\"];\n\t\t\t\t\tif (module.exports === undefined) throw new Error(\"Cannot find module @luna/core in luna.core.modules\");\n\t\t\t\t\t// Icky but it works\n\t\t\t\t\tluna.core.LunaPlugin.plugins[\"@luna/core\"]?.addDependant(luna.core.LunaPlugin.plugins[\"@spotifynutzeer/link-copy\"]);\n\t\t\t\t", "\n\t\t\t\t\tmodule.exports = luna?.core?.modules?.[\"@luna/lib\"];\n\t\t\t\t\tif (module.exports === undefined) throw new Error(\"Cannot find module @luna/lib in luna.core.modules\");\n\t\t\t\t\t// Icky but it works\n\t\t\t\t\tluna.core.LunaPlugin.plugins[\"@luna/lib\"]?.addDependant(luna.core.LunaPlugin.plugins[\"@spotifynutzeer/link-copy\"]);\n\t\t\t\t", "\n\t\t\t\t\tmodule.exports = luna?.core?.modules?.[\"react\"];\n\t\t\t\t\tif (module.exports === undefined) throw new Error(\"Cannot find module react in luna.core.modules\");\n\t\t\t\t\t// Icky but it works\n\t\t\t\t\tluna.core.LunaPlugin.plugins[\"react\"]?.addDependant(luna.core.LunaPlugin.plugins[\"@spotifynutzeer/link-copy\"]);\n\t\t\t\t", "\n\t\t\t\t\tmodule.exports = luna?.core?.modules?.[\"@luna/ui\"];\n\t\t\t\t\tif (module.exports === undefined) throw new Error(\"Cannot find module @luna/ui in luna.core.modules\");\n\t\t\t\t\t// Icky but it works\n\t\t\t\t\tluna.core.LunaPlugin.plugins[\"@luna/ui\"]?.addDependant(luna.core.LunaPlugin.plugins[\"@spotifynutzeer/link-copy\"]);\n\t\t\t\t", "import { LunaUnload, Tracer } from \"@luna/core\";\nimport { MediaItem, ContextMenu, MediaItems, redux } from \"@luna/lib\";\n\nexport const { trace } = Tracer(\"[LinkCopy]\");\nexport const unloads = new Set<LunaUnload>();\n\nlet lastTrackId: string | null = null;\nlet currentTrackCache: { id: string, links: any } | null = null;\n\nasync function getLinks(url: string, trackId: string) {\n    // Return cached links if it's the same track\n    if (currentTrackCache && currentTrackCache.id === trackId) {\n        console.log(\"[LinkCopy] Using cached links for track:\", trackId);\n        return currentTrackCache.links;\n    }\n\n    console.log(\"[LinkCopy] Fetching Odesli links for:\", url);\n    try {\n        const response = await fetch(`https://api.song.link/v1-alpha.1/links?url=${encodeURIComponent(url)}`);\n        const data = await response.json();\n        return data.linksByPlatform;\n    } catch (err) {\n        console.error(\"[LinkCopy] Odesli fetch failed:\", err);\n        return null;\n    }\n}\n\n// Prefetch for currently playing track\nMediaItem.onMediaTransition(unloads, async (mediaItem) => {\n    try {\n        const id = mediaItem.id;\n        const url = `https://listen.tidal.com/track/${id}`;\n        console.log(\"[LinkCopy] Prefetching links for playing track:\", id);\n        \n        const response = await fetch(`https://api.song.link/v1-alpha.1/links?url=${encodeURIComponent(url)}`);\n        const data = await response.json();\n        \n        currentTrackCache = {\n            id: id,\n            links: data.linksByPlatform\n        };\n        console.log(\"[LinkCopy] Prefetch complete.\");\n    } catch (err) {\n        console.error(\"[LinkCopy] Prefetch failed:\", err);\n    }\n});\n\nfunction copyToClipboard(text: string, platform: string) {\n    const textArea = document.createElement(\"textarea\");\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    textArea.select();\n    document.execCommand('copy');\n    document.body.removeChild(textArea);\n    \n    redux.store.dispatch({\n        type: \"message/MESSAGE_INFO\",\n        payload: { message: `${platform} link copied to clipboard!` }\n    });\n}\n\nfunction createClonedButton(originalLi: HTMLElement, text: string, onClick: () => void) {\n    const newLi = originalLi.cloneNode(true) as HTMLElement;\n    const btn = newLi.querySelector('button');\n    if (btn) {\n        btn.removeAttribute('data-test');\n        newLi.querySelectorAll('span').forEach(span => {\n            if (span.innerText && span.innerText.length > 1) span.innerText = text;\n        });\n        btn.onclick = (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            onClick();\n        };\n    }\n    newLi.setAttribute('data-link-copy-injected', 'true');\n    return newLi;\n}\n\n// 1. Capture ID on right-click\nContextMenu.onMediaItem(unloads, async ({ mediaCollection }) => {\n    try {\n        const items = (mediaCollection as any).items || (mediaCollection as any).tMediaItems;\n        if (items && items.length > 0) {\n            const firstItem = items[0];\n            lastTrackId = firstItem.id || firstItem.item?.id;\n            console.log(\"[LinkCopy] Context track set to:\", lastTrackId);\n        }\n    } catch (err) {}\n});\n\n// 2. Share menu injection\nconst checkInterval = setInterval(() => {\n    const shareBtn = document.querySelector('[data-test=\"copy-share-link\"]');\n    if (shareBtn && lastTrackId) {\n        const originalLi = shareBtn.closest('li');\n        const parentUl = originalLi?.parentElement;\n\n        if (originalLi && parentUl && !parentUl.querySelector('[data-link-copy-injected=\"true\"]')) {\n            const id = lastTrackId!;\n            const url = `https://listen.tidal.com/track/${id}`;\n\n            parentUl.appendChild(createClonedButton(originalLi, \"Copy Spotify Link\", async () => {\n                const links = await getLinks(url, id);\n                if (links?.spotify?.url) copyToClipboard(links.spotify.url, \"Spotify\");\n                else alert(\"Spotify link not found.\");\n            }));\n\n            parentUl.appendChild(createClonedButton(originalLi, \"Copy YouTube Link\", async () => {\n                const links = await getLinks(url, id);\n                if (links?.youtube?.url) copyToClipboard(links.youtube.url, \"YouTube\");\n                else alert(\"YouTube link not found.\");\n            }));\n        }\n    }\n}, 300);\n\nunloads.add(() => clearInterval(checkInterval));\n\nexport { Settings } from \"./Settings\";\n\nexport async function copyCurrentLink(platform: 'spotify' | 'youtube') {\n    const mediaItem = await MediaItem.fromPlaybackContext();\n    if (!mediaItem) return;\n    const id = mediaItem.id;\n    const url = `https://listen.tidal.com/track/${id}`;\n    const links = await getLinks(url, id);\n    const link = links?.[platform]?.url;\n    if (link) copyToClipboard(link, platform);\n}", "import React from \"react\";\nimport { LunaSettings, LunaButtonSetting } from \"@luna/ui\";\nimport { copyCurrentLink } from \".\";\n\nexport const Settings = () => {\n\treturn (\n\t\t<LunaSettings>\n\t\t\t<LunaButtonSetting \n\t\t\t\ttitle=\"Copy Spotify Link\" \n\t\t\t\tdesc=\"Copy the Spotify link for the currently playing track\" \n\t\t\t\tonClick={() => copyCurrentLink('spotify')} \n\t\t\t/>\n\t\t\t<LunaButtonSetting \n\t\t\t\ttitle=\"Copy YouTube Link\" \n\t\t\t\tdesc=\"Copy the YouTube link for the currently playing track\" \n\t\t\t\tonClick={() => copyCurrentLink('youtube')} \n\t\t\t/>\n\t\t</LunaSettings>\n\t);\n};"],
  "mappings": "ygBAAA,IAAAA,EAAAC,EAAA,CAAAC,EAAAC,IAAA,CACKA,EAAO,QAAU,MAAM,MAAM,UAAU,YAAY,EACnD,GAAIA,EAAO,UAAY,OAAW,MAAM,IAAI,MAAM,oDAAoD,EAEtG,KAAK,KAAK,WAAW,QAAQ,YAAY,GAAG,aAAa,KAAK,KAAK,WAAW,QAAQ,2BAA2B,CAAC,ICJvH,IAAAC,EAAAC,EAAA,CAAAC,EAAAC,IAAA,CACKA,EAAO,QAAU,MAAM,MAAM,UAAU,WAAW,EAClD,GAAIA,EAAO,UAAY,OAAW,MAAM,IAAI,MAAM,mDAAmD,EAErG,KAAK,KAAK,WAAW,QAAQ,WAAW,GAAG,aAAa,KAAK,KAAK,WAAW,QAAQ,2BAA2B,CAAC,ICJtH,IAAAC,EAAAC,EAAA,CAAAC,EAAAC,IAAA,CACKA,EAAO,QAAU,MAAM,MAAM,SAAU,MACvC,GAAIA,EAAO,UAAY,OAAW,MAAM,IAAI,MAAM,+CAA+C,EAEjG,KAAK,KAAK,WAAW,QAAQ,OAAU,aAAa,KAAK,KAAK,WAAW,QAAQ,2BAA2B,CAAC,ICJlH,IAAAC,EAAAC,EAAA,CAAAC,EAAAC,IAAA,CACKA,EAAO,QAAU,MAAM,MAAM,UAAU,UAAU,EACjD,GAAIA,EAAO,UAAY,OAAW,MAAM,IAAI,MAAM,kDAAkD,EAEpG,KAAK,KAAK,WAAW,QAAQ,UAAU,GAAG,aAAa,KAAK,KAAK,WAAW,QAAQ,2BAA2B,CAAC,ICJrH,IAAAC,EAAmC,SACnCC,EAA0D,SCD1D,IAAAC,EAAkB,SAClBC,EAAgD,SAGzC,IAAMC,EAAW,IAEtB,EAAAC,QAAA,cAAC,oBACA,EAAAA,QAAA,cAAC,qBACA,MAAM,oBACN,KAAK,wDACL,QAAS,IAAMC,EAAgB,SAAS,EACzC,EACA,EAAAD,QAAA,cAAC,qBACA,MAAM,oBACN,KAAK,wDACL,QAAS,IAAMC,EAAgB,SAAS,EACzC,CACD,EDdK,GAAM,CAAE,MAAAC,CAAM,KAAI,UAAO,YAAY,EAC/BC,EAAU,IAAI,IAEvBC,EAA6B,KAC7BC,EAAuD,KAE3D,eAAeC,EAASC,EAAaC,EAAiB,CAElD,GAAIH,GAAqBA,EAAkB,KAAOG,EAC9C,eAAQ,IAAI,2CAA4CA,CAAO,EACxDH,EAAkB,MAG7B,QAAQ,IAAI,wCAAyCE,CAAG,EACxD,GAAI,CAGA,OADa,MADI,MAAM,MAAM,8CAA8C,mBAAmBA,CAAG,CAAC,EAAE,GACxE,KAAK,GACrB,eAChB,OAASE,EAAK,CACV,eAAQ,MAAM,kCAAmCA,CAAG,EAC7C,IACX,CACJ,CAGA,YAAU,kBAAkBN,EAAS,MAAOO,GAAc,CACtD,GAAI,CACA,IAAMC,EAAKD,EAAU,GACfH,EAAM,kCAAkCI,CAAE,GAChD,QAAQ,IAAI,kDAAmDA,CAAE,EAGjE,IAAMC,EAAO,MADI,MAAM,MAAM,8CAA8C,mBAAmBL,CAAG,CAAC,EAAE,GACxE,KAAK,EAEjCF,EAAoB,CAChB,GAAIM,EACJ,MAAOC,EAAK,eAChB,EACA,QAAQ,IAAI,+BAA+B,CAC/C,OAASH,EAAK,CACV,QAAQ,MAAM,8BAA+BA,CAAG,CACpD,CACJ,CAAC,EAED,SAASI,EAAgBC,EAAcC,EAAkB,CACrD,IAAMC,EAAW,SAAS,cAAc,UAAU,EAClDA,EAAS,MAAQF,EACjB,SAAS,KAAK,YAAYE,CAAQ,EAClCA,EAAS,OAAO,EAChB,SAAS,YAAY,MAAM,EAC3B,SAAS,KAAK,YAAYA,CAAQ,EAElC,QAAM,MAAM,SAAS,CACjB,KAAM,uBACN,QAAS,CAAE,QAAS,GAAGD,CAAQ,4BAA6B,CAChE,CAAC,CACL,CAEA,SAASE,EAAmBC,EAAyBJ,EAAcK,EAAqB,CACpF,IAAMC,EAAQF,EAAW,UAAU,EAAI,EACjCG,EAAMD,EAAM,cAAc,QAAQ,EACxC,OAAIC,IACAA,EAAI,gBAAgB,WAAW,EAC/BD,EAAM,iBAAiB,MAAM,EAAE,QAAQE,GAAQ,CACvCA,EAAK,WAAaA,EAAK,UAAU,OAAS,IAAGA,EAAK,UAAYR,EACtE,CAAC,EACDO,EAAI,QAAWE,GAAM,CACjBA,EAAE,eAAe,EACjBA,EAAE,gBAAgB,EAClBJ,EAAQ,CACZ,GAEJC,EAAM,aAAa,0BAA2B,MAAM,EAC7CA,CACX,CAGA,cAAY,YAAYjB,EAAS,MAAO,CAAE,gBAAAqB,CAAgB,IAAM,CAC5D,GAAI,CACA,IAAMC,EAASD,EAAwB,OAAUA,EAAwB,YACzE,GAAIC,GAASA,EAAM,OAAS,EAAG,CAC3B,IAAMC,EAAYD,EAAM,CAAC,EACzBrB,EAAcsB,EAAU,IAAMA,EAAU,MAAM,GAC9C,QAAQ,IAAI,mCAAoCtB,CAAW,CAC/D,CACJ,MAAc,CAAC,CACnB,CAAC,EAGD,IAAMuB,EAAgB,YAAY,IAAM,CACpC,IAAMC,EAAW,SAAS,cAAc,+BAA+B,EACvE,GAAIA,GAAYxB,EAAa,CACzB,IAAMc,EAAaU,EAAS,QAAQ,IAAI,EAClCC,EAAWX,GAAY,cAE7B,GAAIA,GAAcW,GAAY,CAACA,EAAS,cAAc,kCAAkC,EAAG,CACvF,IAAMlB,EAAKP,EACLG,EAAM,kCAAkCI,CAAE,GAEhDkB,EAAS,YAAYZ,EAAmBC,EAAY,oBAAqB,SAAY,CACjF,IAAMY,EAAQ,MAAMxB,EAASC,EAAKI,CAAE,EAChCmB,GAAO,SAAS,IAAKjB,EAAgBiB,EAAM,QAAQ,IAAK,SAAS,EAChE,MAAM,yBAAyB,CACxC,CAAC,CAAC,EAEFD,EAAS,YAAYZ,EAAmBC,EAAY,oBAAqB,SAAY,CACjF,IAAMY,EAAQ,MAAMxB,EAASC,EAAKI,CAAE,EAChCmB,GAAO,SAAS,IAAKjB,EAAgBiB,EAAM,QAAQ,IAAK,SAAS,EAChE,MAAM,yBAAyB,CACxC,CAAC,CAAC,CACN,CACJ,CACJ,EAAG,GAAG,EAEN3B,EAAQ,IAAI,IAAM,cAAcwB,CAAa,CAAC,EAI9C,eAAsBI,EAAgBhB,EAAiC,CACnE,IAAML,EAAY,MAAM,YAAU,oBAAoB,EACtD,GAAI,CAACA,EAAW,OAChB,IAAMC,EAAKD,EAAU,GACfH,EAAM,kCAAkCI,CAAE,GAE1CqB,GADQ,MAAM1B,EAASC,EAAKI,CAAE,KACfI,CAAQ,GAAG,IAC5BiB,GAAMnB,EAAgBmB,EAAMjB,CAAQ,CAC5C",
  "names": ["require_core", "__commonJSMin", "exports", "module", "require_lib", "__commonJSMin", "exports", "module", "require_react", "__commonJSMin", "exports", "module", "require_ui", "__commonJSMin", "exports", "module", "import_core", "import_lib", "import_react", "import_ui", "Settings", "React", "copyCurrentLink", "trace", "unloads", "lastTrackId", "currentTrackCache", "getLinks", "url", "trackId", "err", "mediaItem", "id", "data", "copyToClipboard", "text", "platform", "textArea", "createClonedButton", "originalLi", "onClick", "newLi", "btn", "span", "e", "mediaCollection", "items", "firstItem", "checkInterval", "shareBtn", "parentUl", "links", "copyCurrentLink", "link"]
}
